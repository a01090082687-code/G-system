# G-System 구글 스프레드시트 연동 가이드

## 1. Google Apps Script (Code.gs) 배포

### 1-1. 스프레드시트 및 시트 탭 준비

1. [Google Drive](https://drive.google.com)에서 **새 Google 스프레드시트**를 만듭니다.
2. 아래 **시트 탭 이름**을 그대로 만들고, 첫 행에 **헤더**를 입력합니다.

| 시트 이름 | 열 구성 (1행=헤더) |
|-----------|-------------------|
| **Members** | name, dept, risk, note, isIntensiveCare, counseling |
| **Risks** | type, dept, health, action, level |
| **Noise** | factory, processName, processDept, measuredDb, standardDb, result, protectionGear |
| **Expenses** | year, month, name, amount, hospital |
| **Innovations** | category, title, desc, date, imageUrl, savings |
| **Config** | key, value (key 예: emergencyContacts, factory1, factory2, medicine_survey_url, stretchingVideos) |

- **Config** 시트: `key` / `value` 두 열만 있으면 됩니다.  
  `value`에는 JSON 문자열을 넣습니다 (예: emergencyContacts, factory1, factory2, medicine_survey_url, stretchingVideos 등).
- 처음 사용 시 시트가 비어 있으면 화면도 비어 있습니다. 기존 `index.html`에 있던 기본 데이터를 시트에 복사해 넣거나, 앱에서 항목을 추가하면 시트에 저장됩니다.

### 1-2. 스크립트 배포

1. 스프레드시트 메뉴에서 **확장 프로그램** → **Apps Script** 를 엽니다.
2. 기본 생성된 `function myFunction() {}` 코드를 **전부 지우고**, 프로젝트의 **`Code.gs`** 파일 내용을 **통째로 붙여넣기** 한 뒤 저장합니다.
3. 상단 **배포** → **새 배포** 를 클릭합니다.
4. **유형 선택** → **웹 앱** 을 선택합니다.
5. **액세스 권한**: **"모든 사용자"** 로 설정합니다.
6. **배포** 를 누르면 **웹 앱 URL** 이 생성됩니다.  
   형식 예: `https://script.google.com/macros/s/xxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxx/exec`
7. 이 **URL을 복사**해 둡니다.

---

## 2. index.html에 URL 넣기

1. **index.html** 을 연 뒤, `<script>` 안에서 **GAS_URL** 을 찾습니다.

```javascript
const GAS_URL = ''; // 예: 'https://script.google.com/macros/s/.../exec'
```

2. **빈 문자열 `''`** 를 지우고, 복사한 **웹 앱 URL** 을 그대로 붙여넣습니다.

```javascript
const GAS_URL = 'https://script.google.com/macros/s/xxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxx/exec';
```

3. 저장한 뒤, **index.html** 을 브라우저에서 열거나 웹 서버로 서비스합니다.

---

## 3. 동작 방식

- **페이지 로드 시**  
  - `GAS_URL` 이 있으면 "데이터 불러오는 중..." 스피너가 뜨고,  
  - `GET` 요청으로 시트 데이터를 불러와 화면에 채웁니다.  
  - `GAS_URL` 이 비어 있으면 스프레드시트 없이 기존 기본 데이터로만 동작합니다.

- **추가/수정/삭제 시**  
  - 관리자가 유해인자, 소음, 혁신성과, 응급연락망, 스트레칭, 상담 이력, 의약품 설문 URL 등을 변경하면  
  - 해당 내용이 **POST** 로 전송되어 구글 시트에 반영되고,  
  - 필요 시 데이터를 다시 불러와 화면을 갱신합니다.

---

## 4. CORS / 오류 시 확인 사항

- **CORS 오류**  
  - 웹 앱 배포 시 **"모든 사용자"** 로 열어두었는지 확인합니다.  
  - `index.html` 을 **로컬 파일(file://)** 로만 열면 일부 환경에서 CORS 제한이 걸릴 수 있으므로,  
    가능하면 **웹 서버**(예: 로컬 서버, GitHub Pages, 호스팅)에 올려서 **https(또는 http) 주소**로 접속해 테스트하는 것을 권장합니다.

- **데이터가 안 보일 때**  
  - 시트 탭 이름이 **Members, Risks, Noise, Expenses, Innovations, Config** 와 **완전히 동일**한지 확인합니다.  
  - 각 시트 **1행은 반드시 헤더**이고, **2행부터** 데이터가 오도록 합니다.

- **저장이 안 될 때**  
  - 브라우저 개발자 도구(F12) → **Console** 에서 에러 메시지를 확인합니다.  
  - GAS 쪽 **실행 로그**(Apps Script 편집기에서 **보기** → **실행 로그**)도 확인합니다.
