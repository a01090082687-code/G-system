# 다른 기기에서 데이터가 안 보이는 문제 해결 방법

## 문제 상황
- 내 컴퓨터에서는 의약품 설문, 스트레칭 영상, 소음 배치도가 모두 정상 작동
- 다른 기기(핸드폰 등)에서는 세 가지 모두 보이지 않음

## 원인 분석

다른 기기에서 데이터가 안 보이는 이유는 **Google Sheets에서 데이터를 가져오지 못하기 때문**입니다.

현재 코드는:
1. **Google Sheets에서 데이터 로드 시도** (우선)
2. 실패하면 localStorage에서 복원 (fallback)

다른 기기에서는 localStorage에 데이터가 없으므로, Google Sheets에서 데이터를 가져와야 합니다.

---

## 해결 방법

### 1단계: 브라우저 콘솔 확인 (가장 중요!)

**다른 기기에서:**
1. GitHub Pages 사이트 접속: `https://a01090082687-code.github.io`
2. 개발자 도구 열기:
   - **Chrome/Edge (모바일)**: 주소창에 `chrome://inspect` 입력 → 원격 디버깅
   - **데스크톱**: `F12` 또는 `Ctrl+Shift+I`
3. **Console** 탭 확인
4. 다음 메시지들을 확인:

#### ✅ 정상 작동 시:
```
📡 Google Sheets 데이터 로드 시도: https://script.google.com/...
✅ Google Sheets 데이터 로드 성공
```

#### ❌ 문제 발생 시:
```
❌ Google Sheets 데이터 로드 실패: ...
CORS policy 오류
Failed to fetch
```

---

### 2단계: Google Sheets Config 시트 확인

1. Google Sheets 열기
2. **Config** 시트 탭 클릭
3. 다음 데이터가 있는지 확인:

| key | value |
|-----|-------|
| medicine_survey_url | `https://docs.google.com/forms/d/...` |
| stretchingVideos | `[{"id":1,"title":"...","videoUrl":"..."}]` |
| floorplans | `{"factory1":"data:image/png;base64,...","factory2":"..."}` |

**없다면:**
- 관리자 모드로 로그인
- 각 항목을 저장하여 Google Sheets에 업로드

---

### 3단계: Google Apps Script 배포 확인

1. Google Sheets → **확장 프로그램** → **Apps Script**
2. **배포** → **배포 관리** 클릭
3. 확인 사항:
   - [ ] 웹 앱으로 배포되어 있음
   - [ ] **"액세스 권한이 있는 사용자"**가 **"모든 사용자"**로 설정됨
   - [ ] 배포 URL이 `index.html`의 `GAS_URL`과 일치함

---

### 4단계: index.html의 GAS_URL 확인

`index.html` 파일에서:
```javascript
const GAS_URL = 'https://script.google.com/macros/s/AKfycbwbgaXrWpSQaDVYd0pwSkBc1uD1f3dOhZuu4XGQMDi69ecDXz5CcUjzXVeSuZKVMHYBBA/exec';
```

이 URL이 Google Apps Script 배포 URL과 일치하는지 확인하세요.

---

## 빠른 해결 체크리스트

### 다른 기기에서 테스트할 때:

1. **브라우저 콘솔 확인**
   - [ ] `✅ Google Sheets 데이터 로드 성공` 메시지가 보임
   - [ ] CORS 오류가 없음
   - [ ] `Failed to fetch` 오류가 없음

2. **Google Sheets 데이터 확인**
   - [ ] Config 시트에 `medicine_survey_url` 값이 있음
   - [ ] Config 시트에 `stretchingVideos` 배열이 있음
   - [ ] Config 시트에 `floorplans` 객체가 있음

3. **Google Apps Script 배포 확인**
   - [ ] 웹 앱으로 배포됨
   - [ ] "모든 사용자" 권한 설정됨
   - [ ] 배포 URL이 올바름

---

## 자동 새로고침 확인

코드에 **10초마다 자동 새로고침** 기능이 있습니다:
```javascript
setInterval(function() {
    loadDataFromSheets(true); // 10초마다 Google Sheets에서 데이터 가져오기
}, 10000);
```

따라서:
- 다른 기기에서 접속 후 **최대 10초** 기다리면 데이터가 자동으로 로드됩니다
- 관리자가 데이터를 저장하면, 다른 사용자는 **최대 10초 내**에 자동으로 최신 데이터를 볼 수 있습니다

---

## 문제가 계속되면

### 1. 브라우저 캐시 삭제
- 다른 기기에서 브라우저 캐시 삭제
- 시크릿 모드로 테스트

### 2. Google Apps Script 재배포
- Apps Script 편집기에서 **배포 관리** → **수정**
- **새 버전으로 배포** 클릭
- "모든 사용자" 권한 확인

### 3. Google Sheets 데이터 재저장
- 관리자 모드로 로그인
- 의약품 설문 URL 다시 저장
- 스트레칭 영상 다시 저장
- 배치도면 다시 업로드

---

## 디버깅 팁

다른 기기에서 브라우저 콘솔에 다음 코드를 입력하여 수동으로 데이터 로드 테스트:

```javascript
// GAS_URL 확인
console.log('GAS_URL:', GAS_URL);

// 수동으로 데이터 로드 시도
loadDataFromSheets().then(function() {
    console.log('✅ 데이터 로드 성공');
    console.log('의약품 설문 URL:', medicineSurveyUrlFromServer);
    console.log('스트레칭 영상:', APP_DATA.stretchingVideos);
    console.log('배치도:', APP_DATA.floorplans);
}).catch(function(err) {
    console.error('❌ 데이터 로드 실패:', err);
});
```

이 코드를 실행하면 정확히 어디서 문제가 발생하는지 알 수 있습니다.

---

## 예상되는 문제와 해결책

| 문제 | 원인 | 해결책 |
|------|------|--------|
| CORS 오류 | Google Apps Script 배포 권한 문제 | "모든 사용자"로 재배포 |
| Failed to fetch | 네트워크 오류 또는 GAS_URL 오류 | GAS_URL 확인, 네트워크 확인 |
| 데이터는 로드되지만 화면에 안 보임 | 렌더링 함수 오류 | 브라우저 콘솔에서 에러 확인 |
| 일부만 안 보임 | Google Sheets에 해당 데이터가 없음 | 관리자 모드에서 데이터 저장 |

---

**가장 중요한 것은 브라우저 콘솔을 확인하는 것입니다!** 콘솔에 어떤 메시지가 나타나는지 알려주시면 더 정확한 해결책을 제시할 수 있습니다.
